// Get JSON file

var nickcageJSON = '[{"unit":636,"show_id":643557,"show_title":"It Could Happen to You","release_year":"1994","rating":"3.4","category":"Comedies","show_cast":"Nicolas Cage, Bridget Fonda, Rosie P\u00e9rez, Wendell Pierce, Isaac Hayes, V\u00edctor Rojas, Seymour Cassel, Stanley Tucci, J.E. Freeman","director":"Andrew Bergman","summary":"In this charming romantic comedy based on a true story, a coffee-shop waitress gets a life-changing tip when a beat cop comes up short on pocket change and promises her half of his potential winnings from a lottery ticket.","poster":"http:\/\/netflixroulette.net\/api\/posters\/643557.jpg","mediatype":0,"runtime":"101 min"},{"unit":800,"show_id":70143241,"show_title":"The Croods","release_year":"2013","rating":"4.1","category":"Children & Family Movies","show_cast":"Nicolas Cage, Emma Stone, Ryan Reynolds, Catherine Keener, Cloris Leachman, Clark Duke, Chris Sanders, Randy Thom","director":"Kirk De Micco, Chris Sanders","summary":"When an earthquake obliterates their cave, an unworldly prehistoric family is forced to journey through unfamiliar terrain in search of a new home. But things for pessimistic dad Grug go from bad to worse when his daughter meets a clever cave boy.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70143241.jpg","mediatype":0,"runtime":"98 min"},{"unit":2651,"show_id":70131173,"show_title":"Christmas Carol: The Movie","release_year":"2001","rating":"3.5","category":"Children & Family Movies","show_cast":"Simon Callow, Rhys Ifans, Kate Winslet, Nicolas Cage, Jane Horrocks, Michael Gambon, Juliet Stevenson, Robert Llewellyn, Iain Jones, Colin McFarlane","director":"Jimmy T. Murakami","summary":"Nicolas Cage, Kate Winslet and Simon Callow provide voices for this animated version of the classic Charles Dickens tale about the miserable Ebenezer Scrooge, who learns the true meaning of Christmas from three ghosts who confront him in the night. The film uses live-action sequences to bookend the story, and a mouse in the animated portion helps younger viewers follow the story. Winslet sings the film\'s main theme.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70131173.jpg","mediatype":0,"runtime":"77 min"},{"unit":3863,"show_id":70257818,"show_title":"Stolen","release_year":"2012","rating":"3.7","category":"Action & Adventure","show_cast":"Nicolas Cage, Josh Lucas, Danny Huston, Malin Akerman, Sami Gayle, Edrick Browne, Mark Valley, Barry Shabaka Henley, M.C. Gainey","director":"Simon West","summary":"Master thief Will Montgomery is ready to leave his criminal past behind. But when his daughter is kidnapped, he has no choice but to reunite with his old partner in crime and pull off one last heist.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70257818.jpg","mediatype":0,"runtime":"96 min"},{"unit":5221,"show_id":70135880,"show_title":"Seeking Justice","release_year":"2011","rating":"3.8","category":"Action & Adventure","show_cast":"Nicolas Cage, January Jones, Guy Pearce, Harold Perrineau, Jennifer Carpenter, Xander Berkeley, IronE Singleton, Wayne P\u00e9re, Marcus Lyle Brown, Jason Davis","director":"Roger Donaldson","summary":"After his wife is brutally raped, English teacher Will Gerard is approached by a man from a vigilante group who offers to exact revenge on the perpetrator. But once the deed is done, Will discovers that the group expects a certain favor in return.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70135880.jpg","mediatype":0,"runtime":"105 min"},{"unit":6000,"show_id":70206627,"show_title":"Trespass","release_year":"2011","rating":"3.5","category":"Thrillers","show_cast":"Nicolas Cage, Nicole Kidman, Ben Mendelsohn, Liana Liberato, Cam Gigandet, Jordana Spiro, Dash Mihok, Emily Meade, Nico Tortorella, Brandon Belknap","director":"Joel Schumacher","summary":"A husband and wife find themselves pushed to their absolute limit when they\'re held for ransom by brutal thugs who invade their home. As tensions escalate and shocking revelations emerge, the couple is forced to take ever-more desperate measures.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70206627.jpg","mediatype":0,"runtime":"91 min"},{"unit":8054,"show_id":70253159,"show_title":"Frozen Ground","release_year":"2013","rating":"3.4","category":"Thrillers","show_cast":"Nicolas Cage, Vanessa Hudgens, John Cusack, Dean Norris, Gia Mantegna, Robert Forgit, Brad William Henke, Michael McGrady, Radha Mitchell, 50 Cent","director":"Scott Walker","summary":"In this fact-based thriller, an Alaska state trooper pursuing a serial killer teams with a 17-year-old-prostitute who escaped the predator\'s clutches.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70253159","mediatype":0,"runtime":"N\/A"},{"unit":16989,"show_id":1154341,"show_title":"Face\/Off","release_year":"1997","rating":"3.7","category":"Action & Adventure","show_cast":"John Travolta, Nicolas Cage, Joan Allen, Alessandro Nivola, Gina Gershon, Dominique Swain, Nick Cassavetes, Harve Presnell, Colm Feore, John Carroll Lynch","director":"John Woo","summary":"An antiterrorism agent goes under the knife to acquire the likeness of a terrorist and gather details about a bombing plot.","poster":"http:\/\/netflixroulette.net\/api\/posters\/1154341.jpg","mediatype":0,"runtime":"N\/A"},{"unit":17703,"show_id":80005641,"show_title":"Rage","release_year":"2014","rating":"2.9","category":"Action & Adventure","show_cast":"Nicolas Cage, Danny Glover, Michael McGrady, Peter Stormare, Max Ryan, Rachel Nichols, Patrice Cols, Weston Cage, Aubrey Peeples, Pasha D. Lychnikoff","director":"Paco Cabezas","summary":"When his daughter is abducted, a respectable businessman with a violent past rounds up his old crew to help him find her -- by any means necessary.","poster":"http:\/\/netflixroulette.net\/api\/posters\/80005641.jpg","mediatype":0,"runtime":"N\/A"},{"unit":47519,"show_id":772556,"show_title":"Moonstruck","release_year":"1987","rating":"3.5","category":"Romantic Movies","show_cast":"Cher, Nicolas Cage, Vincent Gardenia, Olympia Dukakis, Danny Aiello, Julie Bovasso, John Mahoney, Louis Guss, Feodor Chaliapin Jr., Anita Gillette","director":"Norman Jewison","summary":"In this slice-of-life comedy about the Italian American residents of a Brooklyn neighborhood, a strong widow falls in love with a one-handed baker.","poster":"http:\/\/netflixroulette.net\/api\/posters\/772556.jpg","mediatype":0,"runtime":"N\/A"},{"unit":47637,"show_id":70293723,"show_title":"Joe","release_year":"2013","rating":"3.1","category":"Independent Movies","show_cast":"Nicolas Cage, Tye Sheridan, Gary Poulter, Ronnie Gene Blevins, Sue Rock, Adriene Mishler, Heather Kafka","director":"David Gordon Green","summary":"When ex-con Joe hires 15-year-old Gary to help clear trees for a lumber company, he doesn\'t expect to become a father figure for the abused boy.","poster":"http:\/\/netflixroulette.net\/api\/posters\/70293723.jpg","mediatype":0,"runtime":"N\/A"},{"unit":47642,"show_id":692295,"show_title":"Leaving Las Vegas","release_year":"1995","rating":"3.5","category":"Romantic Movies","show_cast":"Nicolas Cage, Elisabeth Shue, Julian Sands, Richard Lewis, Steven Weber, Kim Adams, Emily Procter, Stuart Regen, Valeria Golino","director":"Mike Figgis","summary":"An alcoholic moves to Las Vegas to drink himself to death and meets a prostitute who comes to love him, without trying to upset his nihilistic agenda.","poster":"http:\/\/netflixroulette.net\/api\/posters\/692295.jpg","mediatype":0,"runtime":"N\/A"}]';
var cookedData = JSON.parse(nickcageJSON);

// adatmezők típusai

var dataTypes = {
    category: 'String',
    director: 'String',
    mediatype: 'Number',
    poster: 'String',
    rating: 'Number',
    release_year: 'Number',
    runtime: 'String',
    show_cast: 'String',
    show_id: 'Number',
    show_title: 'String',
    summary: 'String',
    unit: 'Number'
}


//// RENDEZÉS

// az ország tömb sorbarendezésének függvényei

function itemsOrderedBy(dataType = 'show_title', ascending = true, list = cookedData.slice()) {
    list.sort(function (a, b) {

        var sorting = ascending ?
            getCompareFunction(dataType)(a[dataType], b[dataType]) :
            getCompareFunction(dataType)(b[dataType], a[dataType]);        

        return sorting;
    });
    return list;
}

// a megfelelő összehasonlító fv-t adja vissza

function getCompareFunction(sortField) {
    var codename = 'compare' + dataTypes[sortField];
    return window[codename];
}

// összehasonlító fv-ek

function compareString(a, b) {
    return a.localeCompare(b);
}

function compareNumber(a, b) {
    return a - b;
}

// a rendezés kezelése
var sortBox = document.querySelector('#sortbox');
sortBox.addEventListener("change", manageReOrder);

function manageReOrder(){
    var category = sortBox.querySelector('#category').value;
    var ascending = sortBox.querySelector('#direction').value === 'true' ? true : false;
    var list = itemsOrderedBy(category, ascending);
    console.log(list);
    createItemDivs(list);
    createItemsTable(list);
}

//// kimenetek készítése

// divek készítése

function createItemDivs(array) {
    var itemContainer = document.querySelector('#itemContainer');
    itemContainer.innerHTML = '';
    for (var i = 0; i < array.length; i++) {
        var itemCard = document.createElement('DIV');
        itemCard.className = 'card';
        itemContainer.appendChild(itemCard);
        var imgDiv = document.createElement('DIV');
        var posterImg = document.createElement('img');
        imgDiv.appendChild(posterImg);
        imgDiv.className = 'img';
        itemCard.appendChild(imgDiv);
        var titleDiv = document.createElement('DIV');
        titleDiv.className = 'title';
        itemCard.appendChild(titleDiv);
        var yearDiv = document.createElement('DIV');
        yearDiv.className = 'year';
        itemCard.appendChild(yearDiv);
        var castDiv = document.createElement('DIV');
        castDiv.className = 'cast';
        itemCard.appendChild(castDiv);
        var descDiv = document.createElement('DIV');
        descDiv.className = 'desc';
        itemCard.appendChild(descDiv);

        //filling up itemcards

        posterImg.src += array[i].poster;
        titleDiv.innerHTML += array[i].show_title;
        yearDiv.innerHTML += array[i].release_year;
        castDiv.innerHTML += array[i].show_cast;
        descDiv.innerHTML += array[i].summary;
    }
}

// a sorrendező alatti táblázatot csinálja meg
var listTable = document.querySelector('#listtable');
function createItemsTable(array){
  listTable.innerHTML = '';
    var thead = document.createElement('thead');
    thead.innerHTML = '<tr><th>Title</th><th>Year</th><tr>';
    listTable.appendChild(thead);
    var tbody = document.createElement('tbody');
    listTable.appendChild(tbody);
    tbody.addEventListener('click', titleSelect);
    for (var i = 0; i < array.length; i++){
        var tr = document.createElement('tr');
        tr.dataset.movie = i;
        tr.innerHTML = '<td>' + array[i].show_title + '</td><td>' + 
                       array[i].release_year + '</td>';
        tbody.appendChild(tr);    
    }

}

// 

function titleSelect(e){
    console.log(e.target);
}

// az adatok kezdeti feltöltése
manageReOrder();